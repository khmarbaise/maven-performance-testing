---
- name: Maven
  hosts: maven

  tasks:
    - name: Add the user `tmpt`
      become: true
      ansible.builtin.user:
        name: tmpt
        comment: The Maven Performance Testing
    - name: Installation zip tool
      become: true
      package:
        name: zip
        state: present
    - name: Installation unzip tool
      become: true
      package:
        name: unzip
        state: present
    - name: Installation Zeitsynchronisation
      become: true
      package:
        name: chrony
        state: present
    - name: Download SDK Man
      command: 'curl -s "https://get.sdkman.io" -o install.sh'
    - name: Make install.sh exectuable
      ansible.builtin.file:
        path: install.sh
        state: touch
        mode: u+rwx,g+x,o+rx
    - name: Install SDK Man
      command: './install.sh'

    - name: Configure SDK Man
      ansible.builtin.template:
        src: templates/config.j2
        dest: .sdkman/etc/config

    - name: Install JDK 8
      ansible.builtin.shell: |
        source ~/.bashrc
        sdk install java 8.0.302-open
      args:
        executable: /bin/bash
    - name: Install JDK 11
      ansible.builtin.shell: |
        source ~/.bashrc
        sdk install java 11.0.12-open
      args:
        executable: /bin/bash
    - name: Install JDK 17
      ansible.builtin.shell: |
        source ~/.bashrc
        sdk install java 17.0.1-open
      args:
        executable: /bin/bash
    # TODO: version etc. make variable with it for easier upgrade.
    - name: Download Hyperfine
      get_url:
        url: https://github.com/sharkdp/hyperfine/releases/download/v1.12.0/hyperfine-v1.12.0-x86_64-unknown-linux-musl.tar.gz
        dest: /tmp/hyperfine.tar.gz
        checksum: sha256:b66e7a55fc1b7fd1f6443861f65bde87a4794c4721dee5e11dc0294f27116efc
    - name: Extract hyperfine.tar.gz into /var/lib/foo
      ansible.builtin.unarchive:
        src: /tmp/hyperfine.tar.gz
        dest: /tmp
        remote_src: true
    - name: hyperfine into /usr/local/bin
      become: true
      ansible.builtin.copy:
        src: /tmp/hyperfine-v1.12.0-x86_64-unknown-linux-musl/hyperfine
        dest: /usr/local/bin/hyperfine
        owner: root
        group: root
        mode: '0755'
        remote_src: yes
